Контрольное задание Интернет магазин.
Имя Фамилия — Сергеев Антон
логин на GitHub — Anton-Sergeen-EA
e-mail — kavery@mail

# Online Store - Исправления после code review.

## Критические исправления.

### 1. Исправлены ссылки на каталог товаров.
**Проблема:** Ошибка `NoReverseMatch` при переходе по ссылкам "Назад к каталогу" или "Перейти к покупкам".
**Решение:** Во всех шаблонах заменены ссылки с `{% url 'product_list' %}` на `{% url 'products:product_list' %}` с 
использованием пространства имён приложения.

### 2. Исправлена страница профиля пользователя.
**Проблема:** Ошибка `TemplateSyntaxError` при открытии `/users/profile/`.
**Решение:** 
- Логика фильтрации заказов перенесена из шаблона в view-функцию `users/views.py`.
- Добавлен расчет `active_orders_count` с использованием Q-объектов Django.
- Обновлен шаблон для использования нового контекста.

### 3. Исправлена страница корзины.
**Проблема:** Django отправлял содержимое `products/urls.py` вместо рендеринга HTML-шаблона
**Решение:** Полностью переработан файл `templates/cart/cart.html`:
- Добавлен корректный HTML-шаблон с отображением товаров.
- Реализована функциональность обновления количества товаров.
- Добавлены кнопки удаления товаров.
- Включены ссылки для продолжения покупок и оформления заказа.

## Улучшения и оптимизации.

### 1. Улучшена обработка количества товара в корзине.
**Проблема:** При добавлении товара не учитывалось количество, уже находящееся в корзине у пользователя.
**Решение:** В `cart/views.py` добавлена проверка:
- Рассчитывается текущее количество товара в корзине пользователя.
- Проверяется, не превышает ли запрашиваемое количество доступный остаток.
- Пользователю показываются информативные сообщения о доступном количестве.

### 2. Добавлена пагинация.
**Проблема:** Списки товаров и истории заказов выводились целиком.
**Решение:** Внедрена пагинация с использованием `django.core.paginator.Paginator`:
- **Товары:** 20 товаров на страницу (`products/views.py`)
- **Заказы:** 30 заказов на страницу (`orders/views.py`)
- Добавлены навигационные элементы в шаблонах.
- Поддержка пагинации для результатов поиска.

## Измененные файлы.

### Шаблоны:
1. `templates/cart/cart.html` - полная переработка.
2. `templates/users/profile.html` - исправлена логика отображения.
3. `templates/products/product_detail.html` - исправлены ссылки.
4. `templates/products/product_list.html` - добавлена пагинация, исправлены ссылки.
5. `templates/orders/order_history.html` - добавлена пагинация.
6. `templates/orders/order_detail.html` - исправлены ссылки.

### Python-код:
1. `users/views.py` - добавлен расчет активных заказов.
2. `cart/views.py` - улучшена проверка доступности товара.
3. `products/views.py` - добавлена пагинация для списка товаров и поиска.
4. `orders/views.py` - добавлена пагинация для истории заказов.

Структура проекта:
online_store/                      # Корневая директория проекта.
├── docker-compose.yml             # Конфигурация Docker Compose для запуска контейнеров.
├── Dockerfile                     # Конфигурация Docker-образа приложения.
├── manage.py                      # Утилита командной строки Django.
├── requirements.txt               # Список Python-зависимостей.
├── wait_for_db.py                 # Скрипт ожидания готовности базы данных.
├── README.md                      # Документация проекта с описанием всех исправлений.
├── online_store/                  # Основной модуль Django проекта.
│   ├── __init__.py                # Маркер Python-пакета.
│   ├── asgi.py                    # Конфигурация ASGI для асинхронного развертывания.
│   ├── settings.py                # Основные настройки Django проекта.
│   ├── urls.py                    # Корневой URL-диспетчер проекта.
│   └── wsgi.py                    # Конфигурация WSGI для развертывания.
├── users/                         # Приложение для управления пользователями.
│   ├── __init__.py                # Маркер Python-пакета.
│   ├── admin.py                   # Конфигурация административной панели для пользователей.
│   ├── apps.py                    # Конфигурация приложения users.
│   ├── forms.py                   # Формы Django для работы с пользователями.
│   ├── migrations/                # Миграции базы данных для приложения users.
│   │   └── 0001_initial.py        # Начальная миграция для модели User.
│   ├── models.py                  # Модели данных (кастомная модель User).
│   ├── urls.py                    # URL-маршруты приложения users.
│   └── views.py                   # Контроллеры (view-функции) приложения users.
├── products/                      # Приложение для управления товарами.
│   ├── __init__.py                # Маркер Python-пакета.
│   ├── admin.py                   # Конфигурация административной панели для товаров.
│   ├── apps.py                    # Конфигурация приложения products.
│   ├── migrations/                # Миграции базы данных для приложения products.
│   │   └── 0001_initial.py        # Начальная миграция для моделей Category, Product, Stock.
│   ├── models.py                  # Модели данных (Category, Product, Stock).
│   ├── urls.py                    # URL-маршруты приложения products.
│   ├── views.py                   # Контроллеры приложения products.
│   └── management/                # Кастомные команды управления.
│       └── commands/              # Пользовательские management команды.
│           ├── export_stock.py    # Экспорт остатков товаров в CSV.
│           ├── load_products.py   # Загрузка товаров из JSON/CSV файлов.
│           └── update_prices.py   # Обновление цен товаров из CSV файла.
├── cart/                          # Приложение для управления корзиной покупок.
│   ├── __init__.py                # Маркер Python-пакета.
│   ├── admin.py                   # Конфигурация административной панели для корзины.
│   ├── apps.py                    # Конфигурация приложения cart.
│   ├── context_processors.py      # Контекстный процессор для отображения количества товаров в корзине.
│   ├── migrations/                # Миграции базы данных для приложения cart.
│   │   └── 0001_initial.py        # Начальная миграция для моделей Cart, CartItem.
│   ├── models.py                  # Модели данных (Cart, CartItem).
│   ├── urls.py                    # URL-маршруты приложения cart.
│   └── views.py                   # Контроллеры приложения cart.
├── orders/                        # Приложение для управления заказами.
│   ├── __init__.py                # Маркер Python-пакета.
│   ├── admin.py                   # Конфигурация административной панели для заказов.
│   ├── apps.py                    # Конфигурация приложения orders.
│   ├── migrations/                # Миграции базы данных для приложения orders.
│   │   └── 0001_initial.py        # Начальная миграция для моделей Order, OrderItem.
│   ├── models.py                  # Модели данных (Order, OrderItem).
│   ├── urls.py                    # URL-маршруты приложения orders.
│   └── views.py                   # Контроллеры приложения orders.
├── templates/                     # HTML-шаблоны проекта.
│   ├── base.html                  # Базовый шаблон с навигацией и общими элементами.
│   ├── cart/                      # Шаблоны для корзины.
│   │   └── cart.html              # Основная страница корзины.
│   ├── orders/                    # Шаблоны для заказов.
│   │   ├── order_detail.html      # Детальная информация о заказе.
│   │   ├── order_form.html        # Форма оформления заказа.
│   │   └── order_history.html     # История заказов с пагинацией.
│   ├── products/                  # Шаблоны для товаров.
│   │   ├── product_detail.html    # Детальная страница товара.
│   │   └── product_list.html      # Список товаров с пагинацией и поиском.
│   └── users/                     # Шаблоны для пользователей.
│       ├── login.html             # Страница входа.
│       ├── profile.html           # Страница профиля пользователя.
│       └── register.html          # Страница регистрации.
├── static/                        # Статические файлы (CSS, JS, изображения) для разработки.
├── media/                         # Загружаемые пользователями файлы (изображения товаров).
└── staticfiles/                   # Собранные статические файлы для production.
